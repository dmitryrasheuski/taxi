create database taxi CHARACTER SET utf8 COLLATE utf8_general_ci;
use taxi;

create table user_status(
  id int AUTO_INCREMENT,
  title varchar(15) NOT NULL UNIQUE,
  CONSTRAINT PK_user_status PRIMARY KEY (id)
);

create table car_model(
  id int AUTO_INCREMENT,
  title varchar(30) NOT NULL UNIQUE,
  CONSTRAINT PK_car_model PRIMARY KEY (id)
);

create table colors(
  id int AUTO_INCREMENT,
  title varchar(20) NOT NULL UNIQUE,
  CONSTRAINT PK_color PRIMARY KEY (id)
);

create table address(
  id bigint AUTO_INCREMENT,
  title varchar(50) NOT NULL UNIQUE,
  CONSTRAINT PK_address PRIMARY KEY (id)
);

create table users(
  id bigint AUTO_INCREMENT,
  phone int NOT NULL UNIQUE,
  name varchar(20),
  surname varchar(20),
  password varchar(20),
  status_id int NOT NULL ,
  CONSTRAINT PK_users PRIMARY KEY (id),
  CONSTRAINT FC_users_to_user_status FOREIGN KEY (status_id) REFERENCES user_status(id)
);

create table cars(
  id bigint AUTO_INCREMENT,
  number varchar(7) NOT NULL UNIQUE ,
  color_id int NOT NULL,
  model_id int NOT NULL,
  CONSTRAINT PK_cars PRIMARY KEY (id),
  CONSTRAINT FK_cars_to_color_cars FOREIGN KEY (color_id) REFERENCES colors(id) ON UPDATE CASCADE,
  CONSTRAINT FK_cars__to_model_car FOREIGN KEY (model_id) REFERENCES car_model(id) ON UPDATE CASCADE
);

create table car_driver(
  id_car bigint NOT NULL ,
  id_driver bigint NOT NULL,
  CONSTRAINT FK_to_user FOREIGN KEY (id_driver) REFERENCES users(id),
  CONSTRAINT FK_to_cars FOREIGN KEY (id_car) REFERENCES cars(id),
  CONSTRAINT car_unique UNIQUE (id_car),
  CONSTRAINT driver_unique UNIQUE (id_driver)
);

create table orders(
  id bigint AUTO_INCREMENT,
  passenger_id bigint NOT NULL,
  car_id bigint NOT NULL,
  `from_id` bigint NOT NULL,
  `where_id` bigint NOT NULL,
  comment varchar(100),
  CONSTRAINT PK_orders PRIMARY KEY (id),
  CONSTRAINT FK_orders_to_users FOREIGN KEY (passenger_id) REFERENCES users(id),
  CONSTRAINT FK_orders_to_car FOREIGN KEY (car_id) REFERENCES cars(id),
  CONSTRAINT FK_orders_to_address_by_from FOREIGN KEY (`from_id`) REFERENCES address(id),
  CONSTRAINT FK_orders_to_address_by_where FOREIGN KEY (`where_id`) REFERENCES address(id)
);